[首页](../README.md)

## 1.核心概念
- **智能体**：智能体互联中的核心执行单元。每个智能体是由特定的智能体供应商（Agent Provider）创建的，并且在提供服务之前需要先在智能体注册服务商处进行注册并获得身份标识，然后从证书授权服务商获取身份证书。
- **用户**：智能体互联的实际使用者，通过与个人助理交互接入智能体互联。
- **个人助理智能体**：智能体的一种，直接接收用户的请求，负责将用户的需求分解成子任务并寻找合适的智能体完成这些子任务。
- **证书授权服务商（Certificate Authority Service Provider，CASP）**：安全可控的智能体应在可信的证书授权服务商处获得与身份标识对应的数字身份证书。
- **智能体注册服务商（Agent Registration Service Provider，ARSP）**：安全可控的智能体应在智能体注册服务商进行能力注册，并获得身份标识。
- **智能体发现服务商（Agent Discovery Service Provider，ADSP）**：智能体发现服务商通过规范的流程和协议，支持智能体之间识别和理解某个或若干智能体所具备的能力。为确保能力信息的准确性和时效性，智能体发现服务商与智能体注册服务商需要同步信息。
- **智能体身份码（Agent Identity Code，AIC）**：每个智能体具有的可认证的身份标识，其来自于智能体首次注册的智能体注册服务商。
- **智能体能力描述（Agent Capability Specification，ACS）**：采用简洁的方式对智能体能力进行具备一定灵活性的表述
- **智能体身份证书（ Certificate of Agent Identity，CAI）**：由于智能体间必须使用HTTPS协议进行数据传输，因此必须具有 CAI 。
- **智能体交互协议（Agent Interaction Protocol，AIP）**：多智能体系统中，上下文的管理至关重要，我们在 AIP 中定义了多种交互模式以满足不同的交互需求。

## 2.智能体身份码定义

智能体互联要能成为一个安全可靠的智能体系统，其首要条件是运行于其中具备自主执行任务能力的智能体应为安全可靠的实例。要达到这一条件，每个智能体应具有可认证的身份标识，我们将其定义为智能体身份码（Agent Identity Code，AIC）。

每个智能体应具备一个唯一的 AIC，其来自于智能体首次注册的智能体注册服务商（Agent Registration Service Provider，ARSP）。在智能体互联中，可以存在多个智能体注册服务商，每个服务商应为经过共识认可（例如管理机构认证）的服务实体

智能体身份码（Agent Identity Code，AIC）由 32 位字符构成，每位标识符是阿拉伯数字或大写英文字母，其中阿拉伯数字的取值范围为0～9的数字，大写英文字母的取值范围为A~Z。以下为一个 AIC 示例：

```
1 0001 00001 1K9 12345E789 ABCDEF23 53
```

AIC 字段定义为：

●1 位：表示智能体支持的最新协议标准版本号。比如：1表示支持版本号为1的智能体身份码标准。

●2-5 位：表示智能体身份管理功能的提供方，结合OID中国家/地区代码可具体确定一个智能体身份管理功能的提供方。比如：0001代表中国电子技术标准化研究院。

●6~10 位：表示提交智能体注册的实体，该实体可能是机构或者个人，每个实体的编码由智能体身份管理功能的提供方分配。比如：00001代表北京邮电大学。

●11~13 位：表示该智能体注册时间的年份。比如：1K9换算为十进制是2025代表该智能体于2025年注册。

●14~22 位：表示提交注册的智能体本体序列号，该序列号是由智能体身份管理功能的提供方分配的一个用于区分智能体本体的唯一序列号。比如：12345E789。一个智能体身份管理功能提供方可注册的智能体本体最多可达101万亿个。

●23~30 位：表示提交注册的智能体实例序列号，该序列号是由智能体身份管理功能的提供方分配的一个由某一智能体本体创建的智能体实例的唯一序列号。比如：ABCDEF23。一个智能体身份管理功能提供方为每个智能体本体可提供最多可3万亿个的实例注册能力，所有本体创建的所有实例可达300万兆个。

●31~32 位：校验码。校验码的生成和验证方式在下一节中进行说明，示例中的校验码为 53。

## 3.智能体能力描述

智能体互联要能成为一个安全可靠的智能体系统，需要具备的一个重要能力是支持智能体描述自身的能力并进行保存和支持获取。智能体能力描述方式既要保证一定的规范性以便于智能体之间互联互通，也需要具备一定的灵活性以适应基于大模型的智能体复杂能力表述。为达到以上目标，我们定义了智能体能力描述（Agent Capability Specification，ACS）.

以下给出 ACS 核心对象的结构定义，关于 AgentProvider、AgentCapabilities等对象的定义请参考 [数据对象结构定义](../03/ACSs-spec-ACS.md)。

### ACS 格式

```typescript
/**
 * 智能体能力描述规范的根对象。
 * 这是ACS（Agent Capability Specification）的核心数据结构，
 * 完整描述了智能体的身份信息、功能能力、技术特性和服务接口。
 * 用于智能体的注册、发现、匹配和协作。
 */

export interface AgentCapabilitySpec {
  /**
   * 智能体唯一身份标识符，由注册服务分配。
   *
   * @TJS-examples ["10001000011K912345E789ABCDEF2353"]
   */
  aic: string;

  /**
   * 智能体的激活状态，由注册服务维护。
   *
   * @TJS-examples [true, false]
   */
  active: boolean;

  /**
   * 智能体能力描述的最后修改时间，由注册服务提供。
   * 采用ISO 8601格式，包含时区偏移信息，推荐使用北京时间（UTC+8）。
   *
   * @TJS-examples ["2025-03-15T16:30:00+08:00"]
   */
  lastModifiedTime: string;

  /**
   * 此智能体支持的ACPs协议版本，用于协议兼容性检查和版本匹配。
   *
   * @TJS-examples ["01.00"]
   */
  protocolVersion: string;

  /**
   * 此智能体的名称，简洁明了地描述智能体的主要功能。
   *
   * @TJS-examples ["北京城区旅游规划助手", "北京郊区景点推荐代理", "文化导览专家"]
   */
  name: string;

  /**
   * 此智能体的详细描述，帮助用户和其他智能体理解其用途和限制。
   * 应明确说明智能体能做什么和不能做什么，包括地理范围、服务类型等限制。
   *
   * @TJS-examples ["对北京城区旅游的规划和建议。只负责城六区，不负责郊区。北京城区范围旅游景点探索规划代理，专门负责北京城六区（东城/西城/朝阳/海淀/丰台/石景山）的旅游景点推荐和行程规划。拒绝超出城区范围的请求。", "专注于北京郊区（密云/怀柔/延庆/昌平/门头沟/房山/大兴/顺义/平谷/通州）的旅游景点推荐和自然路线规划。拒绝城区范围的请求。"]
   */
  description: string;

  /**
   * 智能体的版本号，智能体提供者自行定义格式。
   * 推荐遵循语义化版本控制规范（Semantic Versioning）。
   * 格式：MAJOR.MINOR.PATCH，当API不兼容时递增MAJOR版本。
   *
   * @TJS-examples ["1.0.0", "2.1.3", "1.2.0-beta.1"]
   */
  version: string;

  /**
   * 智能体图标的URL地址，用于在用户界面中显示智能体标识。
   *
   * @TJS-examples ["https://example.com/icons/beijing-agent.png", "https://cdn.example.com/agents/tour-guide.svg"]
   */
  iconUrl?: string;

  /**
   * 智能体详细文档的URL地址，提供使用说明和API文档。
   *
   * @TJS-examples ["https://docs.example.com/agents/beijing-tour", "https://github.example.com/org/agent/blob/main/README.md"]
   */
  documentationUrl?: string;

  /**
   * 智能体能力展示的Web应用URL，用户可以通过此地址体验智能体功能。
   *
   * @TJS-examples ["https://demo.example.com/beijing-tour", "https://app.example.com/agents/tour-guide"]
   */
  webAppUrl?: string;

  /**
   * 智能体服务提供者的详细信息，包括组织、联系方式等。
   *
   * @TJS-examples [{"organization": "北京邮电大学", "url": "https://ai.bupt.edu.cn", "license": "京ICP备14033833号-1"}]
   */
  provider: AgentProvider;

  /**
   * 用于授权请求的可用安全方案声明。键是方案名称，值是对应的安全方案配置。
   * 遵循 OpenAPI 3.0 安全方案对象规范。智能体可以声明支持多种安全方案，
   * 在实际调用时根据端点的security配置选择合适的认证方式。
   *
   * 本字段通常不为空。
   * 作为Partner的智能体通常作为mutualTLS的服务器端对外提供服务，所以需要定义相应的安全方案。
   * 作为Leader的智能体通常作为mutualTLS的客户端去连接其它的Partner智能体，所以也需要定义相应的安全方案。
   *
   * 目前支持的方案包括：
   * - mutualTLS: 双向TLS认证，适用于智能体间的高安全级别通信
   * - openIdConnect: OpenID Connect认证，适用于用户身份验证场景
   *
   * @TJS-examples [
   *   {
   *     "mtls": {
   *       "type": "mutualTLS",
   *       "description": "智能体间mTLS双向认证",
   *       "x-caChallengeBaseUrl": "https://ca.example.com/challenge"
   *     },
   *     "oidc": {
   *       "type": "openIdConnect",
   *       "description": "用户身份认证",
   *       "openIdConnectUrl": "https://auth.example.com/.well-known/openid-configuration"
   *     }
   *   }
   * ]
   */
  securitySchemes: { [scheme: string]: SecurityScheme };

  /**
   * 智能体端点配置列表，定义智能体可访问的服务端点信息。
   * 每个端点包含URL、传输协议和安全要求。
   * 多个端点应该支持相同的业务功能，支持不同的协议和认证方式，以满足多样化的访问需求。
   *
   * 本字段为空数组，表示本智能体没有提供服务端点给其它智能体使用。这样的智能体通常是面向最终用户的助手类智能体。
   *
   * @TJS-examples [[{"url": "https://api.example.com/acps-v1", "transport": "JSONRPC", "security": [{"mtls": []}]}]]
   */
  endPoints: AgentEndPoint[];

  /**
   * 智能体支持的可选能力声明，如流式响应、异步通知、消息队列等。
   *
   * @TJS-examples [{"streaming": true, "notification": false, "messageQueue": ["mqtt:5.0", "kafka:3.0"]}, {"streaming": false, "notification": true, "messageQueue": []}]
   */
  capabilities: AgentCapabilities;

  /**
   * 所有技能的默认支持输入MIME类型集合，可在每个技能的基础上覆盖。
   * 定义智能体可以接受的输入数据格式。
   *
   * @TJS-examples [["text/plain", "application/json"], ["text/plain", "image/jpeg", "audio/wav"]]
   */
  defaultInputModes: string[];

  /**
   * 所有技能的默认支持输出MIME类型集合，可在每个技能的基础上覆盖。
   * 定义智能体可以生成的输出数据格式。
   *
   * @TJS-examples [["text/plain", "application/json"], ["text/markdown", "application/json", "image/png"]]
   */
  defaultOutputModes: string[];

  /**
   * 智能体可以执行的技能或独特能力集合，每个技能代表一个专门化的功能模块。
   *
   * 本字段为空数组，表示本智能体没有定义任何技能。这样的智能体通常是面向最终用户的助手类智能体。
   *
   * @TJS-examples [[{"id": "beijing-tour/sight-recommender", "name": "景点推荐", "version": "1.0.0", "tags": ["旅游", "北京"]}]]
   */
  skills: AgentSkill[];
}
```

## 4.智能体可信注册

智能体互联要能成为一个安全可靠的智能体系统，运行于其中具备自主执行任务能力的智能体应为安全可靠的实体。要达到这一目标，每个智能体应具备以下两个必要条件：

（1）从智能体注册服务商获得全局唯一的身份标识，该标识为智能体身份码（Agent Identity Code，AIC，参见 ACPs 协议体系中的 AIC 标准定义文档）；

（2）从智能体注册服务商指定的证书授权服务商获得可用于身份验证的数字证书，称为智能体身份证书（Certificate of Agent Identity，CAI）。

满足以上两个条件的智能体注册流程，可称之为智能体可信注册流程。完整的可信注册过程如下所示。

### 可信注册流程

(1) 智能体供应商向智能体注册服务商发送注册请求注册智能体，请求中需包含 ACS 全部或部分信息、ca-challenge-url，申请获取 AIC；

(2) 智能体注册服务商对注册请求的内容进行人工审核；

(3) 智能体注册服务商审核通过后，为智能体分配 AIC；

(4) 如果智能体供应商是首次在证书授权服务商（运行 CA Server）申请证书，需要先在 CA Server 注册账户，注册成功后获得JWK。然后使用 CA Client 工具向 CA Server 申请智能体身份证书，请求中需附带 AIC；

(5) CA Server 根据智能体 AIC 向智能体注册服务商请求获取智能体的详细信息；

(6) 智能体注册服务商根据 AIC 返回智能体详细信息给 CA Server。返回的详细信息中需包含AIC、provider信息以及 ca-challenge-url，ca-challenge-url 用于存放证书发放机构所需的域名持有者身份校验文件。在该路径下智能体供应商应存放对应的令牌文件，文件路径要求如下：`<ca-challenge-url>/<aic>/<token>`；

(7) CA Server 对智能体详细信息进行核对；

(8) 信息核对通过后，CA Server 生成随机 token 并向智能体供应商返回授权URL，然后智能体供应商向这些 URL 发送请求以获取具体的挑战信息，包括挑战类型和token；

(9) 智能体供应商使用获得的 token 和自己的 JWK 指纹计算 `key_authorization` 值作为挑战响应的内容。为了让 CA Server 进行挑战验证，智能体供应商需要使用 Challenge Server ，其url为`ca-challenge-url`，然后将挑战响应内容发送到 Challenge Server 并按规定文件路径存储为令牌文件，以便 CA Server 后续验证； 

(10) Challenge Server 响应设置完成后，智能体供应商向 CA Server 发送通知，表示已准备好接受挑战验证；

(11) CA Server 向 Challenge Server 发起验证请求，Challenge Server 返回令牌文件中存储的挑战响应内容；

(12) CA Server 成功验证挑战响应内容后，CA Server 根据从智能体注册服务商获取的智能体详细信息构造证书，最后智能体供应商向 CA Server 发起证书下载请求获取最终的智能体身份证书。

## 5.智能体身份认证

智能体互联要能成为一个安全可靠的网络基础设施，运行于其中具备自主执行任务能力的智能体应为安全可靠的实体，在 ACPs 协议体系的智能体可信注册流程标准中，为每个智能体提供了两个必要条件：智能体身份码（Agent Identity Code，AIC）、智能体身份证书（ Certificate of Agent Identity，CAI）。

智能体身份的认证可使用多种认证协议。推荐智能体之间使用TLS1.3协议的mTLS方式验证对方的证书。当用户使用个人助理时，个人助理使用OIDC协议验证用户的身份，用户使用TLS1.3协议验证个人助理身份。

## 6.智能体发现

智能体互联要能成为一个安全可靠的智能体系统，需有一个规范灵活的智能体发现过程，以实现智能体之间的协作。本协议定义智能体发现过程（Agent Discovery Protocol，ADP），遵从以下原则并实现相应的目标：

（1）满足异构智能体的协作需求：服务请求智能体可以通过 ADP 机制快速发现满足其能力需求的智能体；

（2）支持动态环境下的自主协作：ADP 机制应能适应因为智能体的加入、退出或变化导致的智能体互联高动态特性，确保服务请求智能体能获取到满足其能力需求的智能体；

### 角色定义：

● 请求智能体：请求智能体是根据任务目标需要其他智能体提供服务进行协作的服务请求发起方。

● 发现智能体：由智能体发现服务商提供的智能体，其功能是接收智能体发现请求，并返回匹配检索结果。发现智能体的信息可以通过在请求智能体所在环境中的配置获得（类似 DNS 服务器配置），也可以通过请求智能体向自己所在的智能体注册服务商发起询问获得。

● 注册智能体：由智能体注册服务器提供的智能体，其功能是对外提供智能体注册服务。

● 服务智能体：由智能体供应商创建并管理的提供服务的智能体。

### 智能体发现流程

（1）请求智能体对任务进行推理；

（2）请求智能体拆解出需要与其他智能体协作的任务，向发现智能体发送智能体发现请求，并携带需要协作的任务信息；

（3）注册智能体向发现智能体发送智能体描述信息，发现智能体存储该信息；注册智能体与发现智能体之间的信息同步参考 [DRC：发现与注册数据同步协议](../08/ACPs-spec-DRC.md/)

（4）发现智能体根据请求中需要协作的任务信息与存储的智能体描述信息进行匹配；

（5）将符合需求的智能体或智能体列表信息返回给请求智能体；

（6）请求智能体根据自己的策略，从列表中选择需要协作的智能体（服务智能体），与他们进行身份验证；

（7）在身份验证成功后，请求智能体与服务智能体建立连接，共同协作完成任务。

## 7.智能体交互

智能体互联要能成为一个安全可靠的智能体系统，需要一套规范的流程和协议支持智能体之间的交互。为构建一个强大、可扩展且实用的多智能体协作环境，ACPs 协议体系中的智能体交互协议（Agent Interaction Protocol，AIP）着重关注智能体之间的交互，其关键目标在于：

（1）协作性：提供标准化的机制以促进智能体间深度协作，使智能体能够主动委托任务（将子任务分配给更合适的智能体）和高效交换上下文信息（共享环境感知、目标状态、知识等）。

（2）互操作性：通过定义标准化的信息格式、语义和交互模式等，屏蔽底层智能体平台、编程语言或内部实现的差异，使由不同团队开发、运行在不同环境、具备不同能力的异构智能体系统能够无缝地发现彼此、理解交互内容并有效协作。

（3）灵活性：支持多样化的交互需求，不强制单一的交互模式，而是允许智能体根据场景选择最合适的交互模式，并能适应不同的信息负载和服务质量要求。

（4）异步性：支持长时间运行的任务，确保请求、中间状态更新和最终结果能够可靠地、按需地传递。智能体发起请求（如委托一个耗时任务）后，无需持续等待响应，可以立即处理其他事务。

### 角色定义

在智能体交互过程中，存在以下两种角色：

（1）领导者（Leader）：在智能体交互中，领导者是指发布任务并组织交互的智能体。在一次完整的交互中，只能有一个领导者。

（2）参与者（Partner）：在智能体交互中，参与者是指接受任务并提供服务的智能体。参与者接受来自领导者的任务后执行并返回执行结果。

### 交互模式

在智能体交互协议中，Leader 和 Partner 之间有三种交互模式：

（1） 直连模式（Direct Interaction Mode）：直连模式下，由 Leader 创建并维护一个 Session，相关的智能体在同一个 Session 中协作完成任务。该 Session 中 Leader 与每个 Partner 直接进行交互，而 Partner 之间无交互。Leader 与 Partner 之间的交互可以采用远程调用、流式传输和异步通知三种实现方式
（2）群组模式（Grouping Interaction Mode）：群组模式下，由 Leader 创建并维护一个 Session，该 Session 中智能体间的交互信息通过一个消息队列（Message Queue）进行分发。Leader 创建 Session 后，邀请相关的 Partner 加入群组并在消息队列中订阅该 Session 中的信息。 然后，Leader 和 Partner 之间的交互信息发送至消息队列，然后由消息队列进行分发。同一群组内的智能体均可通过消息分发模块发送和接收消息。
（3）混合模式（Hybrid Interaction Mode）：混合模式下，由 Leader 创建并维护一个 Session，在该 Session 内，Leader 既可通过直连模式与 Partner 交互，也可通过群组模式与 Partner 交互。

### 交互网络

在智能体交互场景下，智能体以直连与群组两种模式与其他智能体建立连接，部分智能体可同时隶属于不同群组并复用消息队列服务，进而构成动态的智能体交互网络。某一时刻下的智能体交互结构如下图所示:

![交互网络](coreconcepts/pic/交互网络.jpg)

## 8.发现与注册数据同步协议

### 角色定义

- **智能体注册服务商（Agent Registration Service Provider，ARSP）**

​	智能体注册服务商是数据的源头，负责智能体数据的上传、验证、批准、撤销及版本管理，确保数据的完整性、合法性与一致性。其核心职责还包括维护智能体的全局唯一标识（AIC）与版本历史，为ADSP提供可靠的数据基准。

- **智能体发现服务商（Agent Discovery Service Provider，ADSP）**

​	智能体发现服务商负责通过同步机制获取ARSP的数据，支撑智能体的搜索、分析与决策。一个ARSP可以为多个ADSP提供数据，一个ADSP也可以从多个ARSP拉取数据。

### 同步方式

ARSP和ADSP共有三种数据同步方式：

- **全量快照同步：**当ADSP处于**首次启动、本地数据全丢失、落后ARSP的数据保留窗口（如ARSP仅保留2天变更的数据，而ADSP断联5天）** 时，需通过全量快照快速对齐数据。
- **增量快照同步：**全量快照同步完成后，进入增量同步循环，ADSP需实时获取ARSP最新数据变更，持续保持数据一致。
- **主动推送：**若ADSP端对数据实时性要求极高，或需减少ADSP轮询资源消耗的场景，可启用主动推送机制，由ARSP主动推送新数据消息。

若连接意外中断且时间较长，发现服务需再次拉取全量或增量快照，重新对齐数据，保障双方始终同步。
